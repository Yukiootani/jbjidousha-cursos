<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Admin | JB Jidousha Cursos</title>
    
    <style>
        :root {
            --accent-color: #DAA520; 
            --action-color: #1463a5; 
            --error-color: #dc3545;
            --bg-color: #f0f0f0;
            --content-bg: #FFFFFF;
        }
        body { font-family: Arial, sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; }
        .container {
            max-width: 800px; 
            background-color: var(--content-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 2rem; 
            margin: 0 auto; 
        }
        h1 { text-align: center; color: var(--action-color); margin-top: 0; }
        h3 { color: var(--action-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 5px; margin-top: 30px; }
        label { font-weight: bold; margin-bottom: 5px; display: block; }
        
        input[type="text"], input[type="password"], input[type="email"], textarea, select, input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; 
        }
        
        button { 
            padding: 12px; 
            border: none; 
            border-radius: 4px; 
            font-size: 1rem; 
            font-weight: bold; 
            cursor: pointer; 
            width: 100%;
            background-color: var(--action-color);
            color: white;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #0d4a7c; }
        #btnLogout { background-color: #777; margin-top: 20px; }
        
        #status, #loginStatus { 
            text-align: center; 
            font-weight: bold; 
            margin-top: 15px; 
            padding: 10px; 
            border-radius: 4px; 
        }
        .status.success { color: #28a745; background-color: #e9f7ec; }
        .status.error { color: #dc3545; background-color: #fdeeee; }
        .status.loading { color: #007bff; background-color: #e6f2ff; }
        
        #login-section, #admin-section {
            border-top: 5px solid var(--accent-color);
            padding-top: 20px;
        }
        
        /* Estilos da lista de gest√£o */
        .management-list { list-style-type: none; padding-left: 0; }
        .course-item, .module-item, .lesson-item {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .course-item > div, .module-item > div, .lesson-item > div {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .module-list { padding-left: 20px; }
        .lesson-list { padding-left: 40px; }
        
        .delete-btn {
            background-color: var(--error-color);
            color: white;
            padding: 4px 8px;
            font-size: 0.8em;
            width: auto; /* Tamanho autom√°tico */
            font-weight: normal;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Admin JB Jidousha Cursos</h1>

        <section id="login-section">
            <h3>Acesso Restrito</h3>
            <form id="loginForm">
                <label for="login-email">Email:</label>
                <input type="email" id="login-email" required>
                <label for="login-password">Senha:</label>
                <input type="password" id="login-password" required>
                <button type="submit" id="btnLogin">Entrar</button>
            </form>
            <div id="loginStatus" class="status"></div>
        </section>

        <section id="admin-section" style="display: none;">
            
            <div id="status" class="status"></div>

            <h3>1. Adicionar Novo Curso</h3>
            <form id="formCurso">
                <label for="course-id">ID √önico do Curso (sem espa√ßos):</label>
                <input type="text" id="course-id" placeholder="Ex: curso_higienizacao_v1" required>
                
                <label for="course-title">T√≠tulo do Curso:</label>
                <input type="text" id="course-title" placeholder="Ex: Higieniza√ß√£o Profissional" required>
                
                <label for="course-subtitle">Subt√≠tulo (Descri√ß√£o Curta):</label>
                <input type="text" id="course-subtitle" placeholder="O ponto de partida para a sua nova profiss√£o." required>
                
                <label for="course-icon">√çcone (FontAwesome):</label>
                <input type="text" id="course-icon" placeholder="Ex: fa-car-wash" required>

                <button type="submit">Salvar Novo Curso</button>
            </form>
            
            <hr style="margin: 30px 0;">

            <h3>2. Adicionar Novo M√≥dulo</h3>
            <form id="formModulo">
                <label for="module-course">Selecionar Curso:</label>
                <select id="module-course" required>
                    <option value="">-- Carregando Cursos... --</option>
                </select>
                
                <label for="module-title">T√≠tulo do M√≥dulo:</label>
                <input type="text" id="module-title" placeholder="Ex: M√≥dulo 1: Fundamentos" required>
                
                <label for="module-order">Ordem (N√∫mero):</label>
                <input type="number" id="module-order" placeholder="1" required>
                
                <button type="submit">Salvar M√≥dulo</button>
            </form>
            
            <hr style="margin: 30px 0;">
            
            <form id="formAula">
                <h3>3. Adicionar Nova Aula</h3>
                
                <label for="lesson-module">Selecionar M√≥dulo:</label>
                <select id="lesson-module" required>
                    <option value="">-- Selecione um curso primeiro --</option>
                </select>
                
                <label for="lesson-title">T√≠tulo da Aula:</label>
                <input type="text" id="lesson-title" placeholder="Ex: 1.1 Seguran√ßa e Produtos" required>
                
                <label for="lesson-videoid">ID do V√≠deo (YouTube):</label>
                <input type="text" id="lesson-videoid" placeholder="Ex: iWiE3_bToUk" required>
                
                <label for="lesson-description">Descri√ß√£o Curta:</label>
                <textarea id="lesson-description" rows="3" placeholder="O que o aluno vai aprender..."></textarea>
                
                <label for="lesson-order">Ordem (N√∫mero):</label>
                <input type="number" id="lesson-order" placeholder="1" required>

                <button type="submit" id="btnSalvarAula">Salvar Aula</button>
            </form>
            
            <hr style="margin: 30px 0;">
            
            <h3>Conte√∫do Atual da Plataforma</h3>
            <div id="content-list">
                </div>

            <button id="btnLogout">Sair (Logout)</button>
        </section>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script> 

    <script>
      // üîë SUAS CHAVES REAIS
      const firebaseConfig = {
        apiKey: "AIzaSyB3LB3er6lGKd95kHmOlFvO_WappclfOEg",
        authDomain: "jb-jidousha-curso.firebaseapp.com",
        projectId: "jb-jidousha-curso",
        storageBucket: "jb-jidousha-curso.firebasestorage.app",
        messagingSenderId: "825134171693",
        appId: "1:825134171693:web:d4284a093ed261c97a1aa4",
        measurementId: "G-QLS2RVCTQ6"
      };

      // Inicializa√ß√£o
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth(); 

      // Cole√ß√µes
      const CURSOS_COLLECTION = "cursos";
      const MODULOS_COLLECTION = "modulos";
      const AULAS_COLLECTION = "aulas";

      // Elementos do HTML
      const loginSection = document.getElementById('login-section');
      const adminSection = document.getElementById('admin-section');
      const loginForm = document.getElementById('loginForm');
      const loginStatusDiv = document.getElementById('loginStatus');
      const statusDiv = document.getElementById('status');
      const btnLogout = document.getElementById('btnLogout');
      
      const formCurso = document.getElementById('formCurso');
      const formModulo = document.getElementById('formModulo');
      const formAula = document.getElementById('formAula');
      
      const selectCourse = document.getElementById('module-course');
      const selectModule = document.getElementById('lesson-module');
      const contentListDiv = document.getElementById('content-list');

      let cacheCursos = []; 
      let cacheModulos = []; 

      function showStatus(div, message, type) {
          div.textContent = message;
          div.className = 'status ' + type; 
      }

      // --- L√ìGICA DE CARREGAMENTO ---

      async function loadAllContent() {
          selectCourse.innerHTML = '<option value="">-- Selecione o Curso --</option>';
          selectModule.innerHTML = '<option value="">-- Selecione um curso primeiro --</option>'; 
          contentListDiv.innerHTML = '<p>Carregando...</p>';
          
          cacheCursos = [];
          cacheModulos = [];
          
          try {
              // 1. Buscar Cursos
              const coursesSnapshot = await db.collection(CURSOS_COLLECTION).get();
              coursesSnapshot.forEach(doc => {
                  const course = doc.data();
                  course.id = doc.id;
                  cacheCursos.push(course);
                  selectCourse.innerHTML += `<option value="${course.id}">${course.title}</option>`;
              });
              
              // 2. Buscar M√≥dulos
              const modulesSnapshot = await db.collection(MODULOS_COLLECTION).orderBy("order").get();
              modulesSnapshot.forEach(doc => {
                  const modulo = doc.data();
                  modulo.id = doc.id;
                  cacheModulos.push(modulo);
                  // N√ÉO POPULA o selectModule (Form 3) aqui.
              });

              // 3. Buscar Aulas
              const lessonsSnapshot = await db.collection(AULAS_COLLECTION).orderBy("order").get();
              const allLessons = {};
              lessonsSnapshot.forEach(doc => {
                  const lesson = doc.data();
                  lesson.id = doc.id;
                  if (!allLessons[lesson.moduleId]) {
                      allLessons[lesson.moduleId] = [];
                  }
                  allLessons[lesson.moduleId].push(lesson);
              });
              
              // 4. Renderizar a Lista Completa
              renderContentList(cacheCursos, cacheModulos, allLessons);

          } catch (error) {
              console.error("Erro ao carregar conte√∫do:", error);
              showStatus(statusDiv, "Erro ao carregar conte√∫do: " + error.message, "error");
          }
      }
      
      // Fun√ß√£o para renderizar a lista
      function renderContentList(cursos, modulos, aulas) {
          let html = '<ul class="management-list">';
          
          cursos.forEach(curso => {
              html += `<li class="course-item">
                          <div>
                              <strong>${curso.title} (ID: ${curso.id})</strong>
                              <button class="delete-btn" data-id="${curso.id}" data-type="curso">Excluir Curso</button>
                          </div>`;
              
              const modulosDoCurso = modulos.filter(m => m.courseId === curso.id);
              
              if (modulosDoCurso.length > 0) {
                  html += '<ul class="module-list">';
                  modulosDoCurso.forEach(modulo => {
                      html += `<li class="module-item">
                                  <div>
                                      ${modulo.title} (Ordem: ${modulo.order})
                                      <button class="delete-btn" data-id="${modulo.id}" data-type="modulo">Excluir M√≥dulo</button>
                                  </div>`;
                      
                      if (aulas[modulo.id] && aulas[modulo.id].length > 0) {
                          html += '<ul class="lesson-list">';
                          aulas[modulo.id].forEach(aula => {
                              html += `<li class="lesson-item">
                                          <div>
                                              ${aula.title} (Ordem: ${aula.order})
                                              <button class="delete-btn" data-id="${aula.id}" data-type="aula">Excluir Aula</button>
                                          </div>
                                      </li>`;
                          });
                          html += '</ul>';
                      }
                      html += '</li>';
                  });
                  html += '</ul>';
              }
              html += '</li>';
          });
          html += '</ul>';
          contentListDiv.innerHTML = html;
      }
      

      // --- L√ìGICA DE EVENTOS ---

      // Fun√ß√µes de Excluir
      async function deleteItem(id, collectionName) {
          const confirmationText = collectionName === CURSOS_COLLECTION ? 
              'EXCLUIR CURSO? Isto apagar√° o curso, mas N√ÉO os m√≥dulos ou aulas dentro dele (fa√ßa isso manualmente).' :
              (collectionName === MODULOS_COLLECTION ? 
              'EXCLUIR M√ìDULO? Isto N√ÉO apagar√° as aulas dentro dele (fa√ßa isso manualmente).' :
              'EXCLUIR AULA?');
              
          if (!confirm(confirmationText)) return;
          
          try {
              await db.collection(collectionName).doc(id).delete();
              showStatus(statusDiv, "Item exclu√≠do com sucesso!", "success");
              loadAllContent(); // Recarrega tudo
          } catch (error) {
              showStatus(statusDiv, "Erro ao excluir: " + error.message, "error");
          }
      }
      
      // Event listener para os cliques na lista (excluir)
      contentListDiv.addEventListener('click', (e) => {
          if (e.target.classList.contains('delete-btn')) {
              const id = e.target.dataset.id;
              const type = e.target.dataset.type;
              
              if (type === 'curso') deleteItem(id, CURSOS_COLLECTION);
              if (type === 'modulo') deleteItem(id, MODULOS_COLLECTION);
              if (type === 'aula') deleteItem(id, AULAS_COLLECTION);
          }
      });
      
      // Event Listener para filtrar os m√≥dulos quando um curso √© selecionado
      selectCourse.addEventListener('change', () => {
          const selectedCourseId = selectCourse.value;
          populateModuleSelect(selectedCourseId);
      });
      
      // Fun√ß√£o: Popula o dropdown de M√≥dulos (Form 3)
      function populateModuleSelect(selectedCourseId) {
          selectModule.innerHTML = '<option value="">-- Selecione o M√≥dulo --</option>'; // Limpa

          if (!selected
